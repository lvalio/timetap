generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Host {
  id                   String    @id @default(uuid()) @db.Uuid
  email                String    @unique
  name                 String
  slug                 String?   @unique
  description          String?
  avatarUrl            String?   @map("avatar_url")
  timezone             String?
  googleRefreshToken   String?   @map("google_refresh_token")
  stripeAccountId      String?   @map("stripe_account_id")
  subscriptionId       String?   @map("subscription_id")
  subscriptionStatus   String?   @map("subscription_status")
  trialEndsAt          DateTime? @map("trial_ends_at")
  bookableHours        Json?     @map("bookable_hours")
  onboardingCompleted  Boolean   @default(false) @map("onboarding_completed")
  createdAt            DateTime  @default(now()) @map("created_at")
  updatedAt            DateTime  @updatedAt @map("updated_at")

  packages  Package[]
  customers Customer[]
  bookings  Booking[]

  @@map("hosts")
}

model Package {
  id            String   @id @default(uuid()) @db.Uuid
  hostId        String   @map("host_id") @db.Uuid
  name          String
  sessionCount  Int      @map("session_count")
  priceInCents  Int      @map("price_in_cents")
  isFreeIntro   Boolean  @default(false) @map("is_free_intro")
  isActive      Boolean  @default(true) @map("is_active")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  host     Host      @relation(fields: [hostId], references: [id], onDelete: Cascade)
  bookings Booking[]

  @@map("packages")
}

model Customer {
  id        String   @id @default(uuid()) @db.Uuid
  email     String
  name      String?
  hostId    String   @map("host_id") @db.Uuid
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  host     Host      @relation(fields: [hostId], references: [id], onDelete: Cascade)
  bookings Booking[]

  @@unique([hostId, email])
  @@map("customers")
}

model Booking {
  id            String   @id @default(uuid()) @db.Uuid
  hostId        String   @map("host_id") @db.Uuid
  customerId    String   @map("customer_id") @db.Uuid
  packageId     String   @map("package_id") @db.Uuid
  startTime     DateTime @map("start_time")
  endTime       DateTime @map("end_time")
  status        String   @default("confirmed")
  googleEventId String?  @map("google_event_id")
  meetLink      String?  @map("meet_link")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  host     Host     @relation(fields: [hostId], references: [id], onDelete: Cascade)
  customer Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  package  Package  @relation(fields: [packageId], references: [id], onDelete: Cascade)

  @@map("bookings")
}
